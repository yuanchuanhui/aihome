
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
        <meta http-equiv="Cache-Control" content="no-cache" />
        <meta name="viewport" content="width=device-width" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="format-detection" content="telephone=yes" />
        <title>FitDiet</title>
        <!-- head 中 -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
        <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">

        <!-- body 最后 -->
        <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>

        <!-- 如果使用了某些拓展插件还需要额外的JS -->
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js"></script>
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/city-picker.min.js"></script>


        <!-- 页面CSS样式 -->
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="font/iconfont.css" />
        <style>
            .file {
                position: relative;
<!--            display: inline-block;-->
                background-color: blue;
<!--                border: 1px solid #99D3F5;-->
                border-radius: 4px;
                padding: 15px 40px;
                overflow: hidden;
                color: #FFF;
                text-decoration: none;
                text-indent: 0;
                line-height: 37px;
                margin:0 auto;
            }

                .file input {
                    position: relative;
                    font-size: 15px;
                    right: 0;
                    top: 0;
                    background-color: rgb(217, 217, 217);
<!--                opacity: 0;-->
                }

                .file:hover {
                    background: #AADFFD;
                    border-color: #78C3F3;
                    color: #004974;
                    text-decoration: none;
                }

        </style>
    </head>

    <body ontouchstart="">
        <script src="/wechat/js/jquery 1.11.1.min.js"></script>
        <script src="/wechat/js/jquery-weui.min.js"></script>
        <script src="/js/Common.js"></script>

        <div class="weui-flex layout_ico about_topware_title">
            <a href="javascript:history.back(-1)"><img src="img/MyImage/back.png" style="margin-top:8px"></a>
            <div class="weui-flex__item"><label>今日记录</label></div>
            <a href="dietmanage.html" style="margin-right:10px;"><img src="img/MyImage/home_nav.png" style="margin-top:8px"></a>
        </div>
        <div class="all_title" style="margin-top: 43px;">
                <div class="weui-tab__bd stumag_con">

                        <div class="weui-search-bar" style="z-index:9">
                            <form class="weui-search-bar__form">
                                <div class="weui-search-bar__box" style="height:auto;">
                                    <i class="weui-icon-search"></i>
                                    <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索果蔬名称">
                                </div>
                                <label class="weui-search-bar__label" id="searchText">
                                    <i class="weui-icon-search"></i>
                                    <span>搜索</span>
                                </label>
                            </form>
                            <a href="#" id="scan">  <img src="img/MyImage/scan1.png" style="float: right;width: 25px;margin-left:15px">  </a>
                            <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
                        </div>

                        <div class="weui-cells weui-cells_form stumag_con_line">
                            <div class="weui-btn-area evaform_con_btn">
                                    <div style="height: 80px; margin:0px auto;" class="imgs clear">
                                         <div class="img fl hide"></div>
                                         <div class="add fl"></div>
                                               <form id="imgform" class="file" style="background-color: #AADFFD;" action="/imageRecognition" method="post" enctype="multipart/form-data">
                                                           <input type="file" accept="image/*" capture="user" src="./img/qrcode.jpeg" style="margin-bottom: 15px;" class="hide" id="upimg3"  name="file" value="拍照上传" onchange="document.getElementById('imgform').submit()">
                                               </form>
                                    </div>
                            </div>
                        </div>

                        <div class="weui-btn-area evaform_con_btn" style="margin-top:80px">
                            <a class="weui-btn weui-btn_primary" id="btnStuMagSubmit" onclick="submit();">提交</a>
                        </div>

                </div>
            </div>



        </div>

        <script>
            $(function () {
                $("#scan").click(function () {
                    $('.add').trigger('click');
                });
             })
        </script>

        <script>
            $('.add').on('click', function () {
                var this_ = $(this);
                var ua = navigator.userAgent.toLowerCase();
                var isiOS = (ua.indexOf('iphone') != -1) || (ua.indexOf('ipad') != -1);  // ios终端
                if (!isiOS) {
                    this_.next("input").attr('capture', 'camera');
                }
                this_.next("input").fadeOut();
                $.showLoading("正在提交数据");
                // 这里是为了能够多次选定同一张图片
                this_.after('<input type="file" class="hide" id="upimg4" accept="image/*">');
                var imglen = this_.parent(".imgs").children('.img').children("img").length;
                this_.next("input").click().off("change").on('change', function () {
                    var size = (this_.next("input")[0].files[0].size / 1024).toFixed(2);
                    if (size <= 5120) {
                        var img = this_.next("input")[0].files[0];
                        var formData = new FormData();
                        formData.append("picture", img);
                        uploadPic(formData, this_, imglen);
                    } else {
                        swal({
                            title: ' ',
                            text: '您的图片超过5M',
                            type: 'warning',
                            showConfirmButton: false,
                            timer: 1500
                        });
                    }
                });
            });

            function imgresize() {
                setTimeout(function () {
                    var img = $('.img>img');
                    img.each(function () {
                        $(this).height('20.8vw');
                        $(this).width('20.8vw');
                    });
                }, 100);
            }

            var uploadPic = function (formData, this_, imglen) {
                $.ajax({
                    type: "post",
                    url: "{:Url('File/uploadPicture')}",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (XMLHttpRequest) {
                        $('.swal2-confirm').css({ 'background-color': '#c1c1c1', 'border-left-color': '#c1c1c1', 'border-right-color': '#c1c1c1' })
                    },
                    success: function (data) {
                        console.log(data)
                        if (imglen >= 3) {
                            this_.hide();
                        }
                        swal.close();
                        var msg = $.parseJSON(data);
                        if (msg.code == 1) {
                            if (this_.hasClass('add')) {
                                //图片添加
                                this_.parent('.imgs').children(".img").eq(imglen).removeClass('hide')
                                    .append('<img src=' + msg.data.path + ' alt="图片" data-tab=' + msg.data.id + '><span><img src="/home/images/common/default.png" alt=""></span>');

                                // 删除图片
                                $(".img span").on("click", function () {
                                    $(this).parent(".img").remove();
                                    this_.fadeIn();
                                    this_.before('<div class="img fl hide"></div>');
                                });

                                // 图片点击修改
                                /*$(".img>img").on("click", function () {
                                 $(this).parent(".img").remove();
                                 this_.fadeIn().click();
                                 this_.before('<div class="img fl hide"></div>');
                                 });*/
                            } else {
                                //图片修改
                                this_.find('img').remove();
                                this_.append('<img src=' + msg.data.path + ' alt="图片" data-tab=' + msg.data.id + '>');
                            }
                            imgresize();

                        } else {
                            return '';
                        }
                    },
                    error: function (data) {
                        alert(JSON.stringify(data));
                    }
                });
                $.hideLoading();
            }
        </script>

        <script>
            function submit() {

                         $.alert("你添加了食材: 苹果");
                    $.hideLoading();
            }
        </script>



    </body>
