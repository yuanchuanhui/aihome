
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
        <meta http-equiv="Cache-Control" content="no-cache" />
        <meta name="viewport" content="width=device-width" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="format-detection" content="telephone=yes" />
        <title>FitDiet</title>
        <!-- head 中 -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
        <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">

        <!-- body 最后 -->
        <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>

        <!-- 如果使用了某些拓展插件还需要额外的JS -->
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js"></script>
        <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/city-picker.min.js"></script>


        <!-- 页面CSS样式 -->
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="font/iconfont.css" />
        <style>
            .file {
                position: relative;
                display: inline-block;
                background: rgb(24, 146, 249);
                border: 1px solid #99D3F5;
                border-radius: 4px;
                padding: 4px 52px;
                overflow: hidden;
                color: #FFF;
                text-decoration: none;
                text-indent: 0;
                line-height: 37px;
                margin-left: 58px;
            }

                .file input {
                    position: absolute;
                    font-size: 100px;
                    right: 0;
                    top: 0;
                    opacity: 0;
                }

                .file:hover {
                    background: #AADFFD;
                    border-color: #78C3F3;
                    color: #004974;
                    text-decoration: none;
                }
        </style>
    </head>

    <body ontouchstart="">
        <script src="/wechat/js/jquery 1.11.1.min.js"></script>
        <script src="/wechat/js/jquery-weui.min.js"></script>
        <script src="/js/Common.js"></script>

        <div class="weui-flex layout_ico about_topware_title">
            <a href="javascript:history.back(-1)"><img src="img/MyImage/back.png" style="margin-top:8px"></a>
            <div class="weui-flex__item"><label>今日记录</label></div>
            <a href="dietmanage.html" style="margin-right:10px;"><img src="img/MyImage/home_nav.png" style="margin-top:8px"></a>
        </div>
        <div class="all_title" style="margin-top: 43px;">

            <div class="weui-tab stuinfo_title">
                <div class="weui-navbar" style="position:fixed; margin-top:40px;">
                    <a class="weui-navbar__item weui-bar__item--on" href="#StuLeaveHistory">
                        手动输入
                        <span class="stuinfo_title_ac"></span>
                    </a>
                    <a class="weui-navbar__item" href="#VacaApply">
                        智能识别
                        <span class=""></span>
                    </a>
                </div>
                <div class="weui-tab__bd stumag_con">
                    <div id="StuLeaveHistory" class="weui-tab__bd-item weui-tab__bd-item--active">
                        <div class="weui-search-bar" style="z-index:9">
                            <form class="weui-search-bar__form">
                                <div class="weui-search-bar__box" style="height:auto;">
                                    <i class="weui-icon-search"></i>
                                    <input type="search" class="weui-search-bar__input" id="searchInput" placeholder="搜索果蔬名称">
                                </div>
                                <label class="weui-search-bar__label" id="searchText">
                                    <i class="weui-icon-search"></i>
                                    <span>搜索</span>
                                </label>
                            </form>
                            <a href="javascript:" class="weui-search-bar__cancel-btn" id="searchCancel">取消</a>
                        </div>
                        <div class="weui-btn-area evaform_con_btn">
                            <a class="weui-btn weui-btn_primary" id="btnStuMagSubmit" onclick="submit();">提交</a>
                        </div>
                    </div>

                    <div id="VacaApply" class="weui-tab__bd-item">
                        <div class="weui-cells weui-cells_form stumag_con_line">

                            <div class="weui-btn-area evaform_con_btn">
                                <!--<a class="weui-btn weui-btn_primary">
        <input type="file" class="hide weui-btn weui-btn_primary" id="upimg3" accept="image/*" name="file">  拍照上传图片
    </a>-->
                               

                                <a href="javascript:;" class="file">
                                    选择文件
                                    <input type="file" name="" id="">
                                </a>
                            </div>

                            <div class="weui-btn-area evaform_con_btn">
                                <a class="weui-btn weui-btn_primary" id="btnStuMagSubmit" onclick="submit();">提交</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>

        <script>
            $(function () {
                $(".js-item").click(function () {
                    $(this).next("div").toggle();
                    if ($(this).next("div").is(":hidden")) {
                        $(this).find('.iconfont').removeClass("icon-rotate");
                    }
                    else {
                        $(this).find('.iconfont').addClass("icon-rotate");
                    }
                });
                $(".weui-navbar__item").click(function () {
                    $(".weui-navbar__item").each(function () {
                        $(this).children().removeClass("stuinfo_title_ac");
                    });
                    $(this).children().addClass("stuinfo_title_ac");
                });
            })
        </script>

        // 图片上传
        <script>
            //图片预览
            $('.add').on('click', function () {
                var this_ = $(this);
                var ua = navigator.userAgent.toLowerCase();
                var isiOS = (ua.indexOf('iphone') != -1) || (ua.indexOf('ipad') != -1);  // ios终端
                if (!isiOS) {
                    this_.next("input").attr('capture', 'camera');
                }
                this_.next("input").fadeOut();
                // 这里是为了能够多次选定同一张图片
                this_.after('<input type="file" class="hide" id="upimg4" accept="image/*">');
                var imglen = this_.parent(".imgs").children('.img').children("img").length;
                this_.next("input").click().off("change").on('change', function () {
                    var size = (this_.next("input")[0].files[0].size / 1024).toFixed(2);
                    if (size <= 5120) {
                        var img = this_.next("input")[0].files[0];
                        var formData = new FormData();
                        formData.append("picture", img);
                        uploadPic(formData, this_, imglen);
                    } else {
                        swal({
                            title: ' ',
                            text: '您的图片超过5M',
                            type: 'warning',
                            showConfirmButton: false,
                            timer: 1500
                        });
                    }
                });
            });

            function imgresize() {
                setTimeout(function () {
                    var img = $('.img>img');
                    img.each(function () {
                        $(this).height('20.8vw');
                        $(this).width('20.8vw');
                    });
                }, 100);
            }

            var uploadPic = function (formData, this_, imglen) {
                $.ajax({
                    type: "post",
                    url: "{:Url('File/uploadPicture')}",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (XMLHttpRequest) {
                        $('.swal2-confirm').css({ 'background-color': '#c1c1c1', 'border-left-color': '#c1c1c1', 'border-right-color': '#c1c1c1' })
                    },
                    success: function (data) {
                        alert(data)
                        if (imglen >= 3) {
                            this_.hide();
                        }
                        swal.close();
                        var msg = $.parseJSON(data);
                        if (msg.code == 1) {
                            if (this_.hasClass('add')) {
                                //图片添加
                                this_.parent('.imgs').children(".img").eq(imglen).removeClass('hide')
                                    .append('<img src=' + msg.data.path + ' alt="图片" data-tab=' + msg.data.id + '><span><img src="/home/images/common/default.png" alt=""></span>');

                                // 删除图片
                                $(".img span").on("click", function () {
                                    $(this).parent(".img").remove();
                                    this_.fadeIn();
                                    this_.before('<div class="img fl hide"></div>');
                                });

                                // 图片点击修改
                                /*$(".img>img").on("click", function () {
                                 $(this).parent(".img").remove();
                                 this_.fadeIn().click();
                                 this_.before('<div class="img fl hide"></div>');
                                 });*/
                            } else {
                                //图片修改
                                this_.find('img').remove();
                                this_.append('<img src=' + msg.data.path + ' alt="图片" data-tab=' + msg.data.id + '>');
                            }
                            imgresize();

                        } else {
                            return '';
                        }
                    },
                    error: function (data) {
                        alert(JSON.stringify(data));
                    }
                });
            }
        </script>



        <script>
            function submit() {
                if ($("#from_VacateReasonName").val() == "" || $("#from_VacateReasonName").val() == null) {
                    $.alert("请先选择请假原因！");
                    return;
                }
                console.log($("#from_FromDay").val());
                if ($("#from_FromDay").val() == "" || $("#from_FromDay").val() == null || $("#from_EndDay").val() == "" || $("#from_EndDay").val() == "") {
                    $.alert("请先选择请假日期！");
                    return;
                }
                $.confirm("提交后不能修改，确认提交么？", function () {
                    $.showLoading("正在提交数据");
                    var Reason = null;
                    switch ($("#from_VacateReasonName").val()) {
                        case '事假': Reason = "2"; break;
                        case '病假': Reason = "1"; break;
                        case '外出实习': Reason = "3"; break;
                        case '出国': Reason = "4"; break;
                    }
                    $.post("StuMag_Leave/SaveStuMagLeave", {
                        Sno: "-1",
                        VacateReason: Reason,
                        VacateMsg: $("#VacateMsg").val(),
                        FromDay: (Common.formattoUTC($("#from_FromDay").val())),
                        EndDay: (Common.formattoUTC($("#from_EndDay").val()))
                    }, function (json) {
                        $.hideLoading();
                        $.alert(json, "", function () {
                            //点击确认后的回调函数
                            window.location.href = "./StuMag_Leave";
                        });
                    }, "json");
                });
            }
        </script>



    </body>
